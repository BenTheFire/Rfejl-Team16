@page "/movies/{id}"
@using TicketMaster.Data
@using TicketMaster.Data.DTOs
@using TicketMaster.Data.Services.Interfaces
@using TicketMaster.Objects
@inject IMovieService MS

@code {
    [Parameter] public string Id { get; set; }

    public Movie movieData;
    public List<Casting> castData;
    public string imageLink;

    protected override async Task OnInitializedAsync()
    {
        var result = await MS.FetchMovieDataAsync(Id);
        movieData = result.Movie;
        castData = result.Cast;
        imageLink = await ImgLink();
        base.OnInitialized();
    }

    public async Task<string> ImgLink()
    {
        string imgString = "";
        await foreach (var imgSrc in TicketMasterService.ImageSrcLinkAsync(movieData))
        {
            if (imgSrc != null)
            {
                imgString = imgSrc;
                break;
            }
            else
            {
                continue;
            }
        }
        return imgString;
    }
}

